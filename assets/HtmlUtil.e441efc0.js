import{r as D,ap as P,al as I,n as F,a9 as k,a8 as V,w as y,o as Y,Y as $,g as K,a7 as N,aq as W,an as Q,ar as X}from"./index.a7691a56.js";import{p as R}from"./use-transition.02a8193e.js";const G={target:{type:[Boolean,String,Element],default:!0},noParentEvent:Boolean},it={...G,contextMenu:Boolean};function nt({showing:a,avoidEmit:e,configureAnchorEl:t}){const{props:i,proxy:n,emit:r}=K(),o=D(null);let s=null;function u(c){return o.value===null?!1:c===void 0||c.touches===void 0||c.touches.length<=1}const l={};t===void 0&&(Object.assign(l,{hide(c){n.hide(c)},toggle(c){n.toggle(c),c.qAnchorHandled=!0},toggleKey(c){P(c,13)===!0&&l.toggle(c)},contextClick(c){n.hide(c),I(c),F(()=>{n.show(c),c.qAnchorHandled=!0})},prevent:I,mobileTouch(c){if(l.mobileCleanup(c),u(c)!==!0)return;n.hide(c),o.value.classList.add("non-selectable");const d=c.target;k(l,"anchor",[[d,"touchmove","mobileCleanup","passive"],[d,"touchend","mobileCleanup","passive"],[d,"touchcancel","mobileCleanup","passive"],[o.value,"contextmenu","prevent","notPassive"]]),s=setTimeout(()=>{s=null,n.show(c),c.qAnchorHandled=!0},300)},mobileCleanup(c){o.value.classList.remove("non-selectable"),s!==null&&(clearTimeout(s),s=null),a.value===!0&&c!==void 0&&V()}}),t=function(c=i.contextMenu){if(i.noParentEvent===!0||o.value===null)return;let d;c===!0?n.$q.platform.is.mobile===!0?d=[[o.value,"touchstart","mobileTouch","passive"]]:d=[[o.value,"mousedown","hide","passive"],[o.value,"contextmenu","contextClick","notPassive"]]:d=[[o.value,"click","toggle","passive"],[o.value,"keyup","toggleKey","passive"]],k(l,"anchor",d)});function h(){N(l,"anchor")}function g(c){for(o.value=c;o.value.classList.contains("q-anchor--skip");)o.value=o.value.parentNode;t()}function f(){if(i.target===!1||i.target===""||n.$el.parentNode===null)o.value=null;else if(i.target===!0)g(n.$el.parentNode);else{let c=i.target;if(typeof i.target=="string")try{c=document.querySelector(i.target)}catch{c=void 0}c!=null?(o.value=c.$el||c,t()):(o.value=null,console.error(`Anchor: target "${i.target}" not found`))}}return y(()=>i.contextMenu,c=>{o.value!==null&&(h(),t(c))}),y(()=>i.target,()=>{o.value!==null&&h(),f()}),y(()=>i.noParentEvent,c=>{o.value!==null&&(c===!0?h():t())}),Y(()=>{f(),e!==!0&&i.modelValue===!0&&o.value===null&&r("update:modelValue",!1)}),$(()=>{s!==null&&clearTimeout(s),h()}),{anchorEl:o,canShow:u,anchorEvents:l}}function ot(a,e){const t=D(null);let i;function n(s,u){const l=`${u!==void 0?"add":"remove"}EventListener`,h=u!==void 0?u:i;s!==window&&s[l]("scroll",h,W.passive),window[l]("scroll",h,W.passive),i=u}function r(){t.value!==null&&(n(t.value),t.value=null)}const o=y(()=>a.noParentEvent,()=>{t.value!==null&&(r(),e())});return $(o),{localScrollTarget:t,unconfigureScrollTarget:r,changeScrollEvent:n}}const{notPassiveCapture:M}=W,w=[];function C(a){const e=a.target;if(e===void 0||e.nodeType===8||e.classList.contains("no-pointer-events")===!0)return;let t=R.length-1;for(;t>=0;){const i=R[t].$;if(i.type.name==="QTooltip"){t--;continue}if(i.type.name!=="QDialog")break;if(i.props.seamless!==!0)return;t--}for(let i=w.length-1;i>=0;i--){const n=w[i];if((n.anchorEl.value===null||n.anchorEl.value.contains(e)===!1)&&(e===document.body||n.innerRef.value!==null&&n.innerRef.value.contains(e)===!1))a.qClickOutside=!0,n.onClickOutside(a);else return}}function lt(a){w.push(a),w.length===1&&(document.addEventListener("mousedown",C,M),document.addEventListener("touchstart",C,M))}function at(a){const e=w.findIndex(t=>t===a);e!==-1&&(w.splice(e,1),w.length===0&&(document.removeEventListener("mousedown",C,M),document.removeEventListener("touchstart",C,M)))}let S,z;function rt(a){const e=a.split(" ");return e.length!==2?!1:["top","center","bottom"].includes(e[0])!==!0?(console.error("Anchor/Self position must start with one of top/center/bottom"),!1):["left","middle","right","start","end"].includes(e[1])!==!0?(console.error("Anchor/Self position must end with one of left/middle/right/start/end"),!1):!0}function st(a){return a?!(a.length!==2||typeof a[0]!="number"||typeof a[1]!="number"):!0}const A={"start#ltr":"left","start#rtl":"right","end#ltr":"right","end#rtl":"left"};["left","middle","right"].forEach(a=>{A[`${a}#ltr`]=a,A[`${a}#rtl`]=a});function ct(a,e){const t=a.split(" ");return{vertical:t[0],horizontal:A[`${t[1]}#${e===!0?"rtl":"ltr"}`]}}function J(a,e){let{top:t,left:i,right:n,bottom:r,width:o,height:s}=a.getBoundingClientRect();return e!==void 0&&(t-=e[1],i-=e[0],r+=e[1],n+=e[0],o+=e[0],s+=e[1]),{top:t,bottom:r,height:s,left:i,right:n,width:o,middle:i+(n-i)/2,center:t+(r-t)/2}}function Z(a,e,t){let{top:i,left:n}=a.getBoundingClientRect();return i+=e.top,n+=e.left,t!==void 0&&(i+=t[1],n+=t[0]),{top:i,bottom:i+1,height:1,left:n,right:n+1,width:1,middle:n,center:i}}function _(a,e){return{top:0,center:e/2,bottom:e,left:0,middle:a/2,right:a}}function U(a,e,t,i){return{top:a[t.vertical]-e[i.vertical],left:a[t.horizontal]-e[i.horizontal]}}function O(a,e=0){if(a.targetEl===null||a.anchorEl===null||e>5)return;if(a.targetEl.offsetHeight===0||a.targetEl.offsetWidth===0){setTimeout(()=>{O(a,e+1)},10);return}const{targetEl:t,offset:i,anchorEl:n,anchorOrigin:r,selfOrigin:o,absoluteOffset:s,fit:u,cover:l,maxHeight:h,maxWidth:g}=a;if(Q.is.ios===!0&&window.visualViewport!==void 0){const B=document.body.style,{offsetLeft:T,offsetTop:x}=window.visualViewport;T!==S&&(B.setProperty("--q-pe-left",T+"px"),S=T),x!==z&&(B.setProperty("--q-pe-top",x+"px"),z=x)}const{scrollLeft:f,scrollTop:c}=t,d=s===void 0?J(n,l===!0?[0,0]:i):Z(n,s,i);Object.assign(t.style,{top:0,left:0,minWidth:null,minHeight:null,maxWidth:g,maxHeight:h,visibility:"visible"});const{offsetWidth:E,offsetHeight:H}=t,{elWidth:q,elHeight:j}=u===!0||l===!0?{elWidth:Math.max(d.width,E),elHeight:l===!0?Math.max(d.height,H):H}:{elWidth:E,elHeight:H};let v={maxWidth:g,maxHeight:h};(u===!0||l===!0)&&(v.minWidth=d.width+"px",l===!0&&(v.minHeight=d.height+"px")),Object.assign(t.style,v);const p=_(q,j);let m=U(d,p,r,o);if(s===void 0||i===void 0)L(m,d,p,r,o);else{const{top:B,left:T}=m;L(m,d,p,r,o);let x=!1;if(m.top!==B){x=!0;const b=2*i[1];d.center=d.top-=b,d.bottom-=b+2}if(m.left!==T){x=!0;const b=2*i[0];d.middle=d.left-=b,d.right-=b+2}x===!0&&(m=U(d,p,r,o),L(m,d,p,r,o))}v={top:m.top+"px",left:m.left+"px"},m.maxHeight!==void 0&&(v.maxHeight=m.maxHeight+"px",d.height>m.maxHeight&&(v.minHeight=v.maxHeight)),m.maxWidth!==void 0&&(v.maxWidth=m.maxWidth+"px",d.width>m.maxWidth&&(v.minWidth=v.maxWidth)),Object.assign(t.style,v),t.scrollTop!==c&&(t.scrollTop=c),t.scrollLeft!==f&&(t.scrollLeft=f)}function L(a,e,t,i,n){const r=t.bottom,o=t.right,s=X(),u=window.innerHeight-s,l=document.body.clientWidth;if(a.top<0||a.top+r>u)if(n.vertical==="center")a.top=e[i.vertical]>u/2?Math.max(0,u-r):0,a.maxHeight=Math.min(r,u);else if(e[i.vertical]>u/2){const h=Math.min(u,i.vertical==="center"?e.center:i.vertical===n.vertical?e.bottom:e.top);a.maxHeight=Math.min(r,h),a.top=Math.max(0,h-r)}else a.top=Math.max(0,i.vertical==="center"?e.center:i.vertical===n.vertical?e.top:e.bottom),a.maxHeight=Math.min(r,u-a.top);if(a.left<0||a.left+o>l)if(a.maxWidth=Math.min(o,l),n.horizontal==="middle")a.left=e[i.horizontal]>l/2?Math.max(0,l-o):0;else if(e[i.horizontal]>l/2){const h=Math.min(l,i.horizontal==="middle"?e.middle:i.horizontal===n.horizontal?e.right:e.left);a.maxWidth=Math.min(o,h),a.left=Math.max(0,h-a.maxWidth)}else a.left=Math.max(0,i.horizontal==="middle"?e.middle:i.horizontal===n.horizontal?e.left:e.right),a.maxWidth=Math.min(o,l-a.left)}class ut{static async readBlob(e,t){return new Promise(i=>{const n=new FileReader;switch(n.onload=function(r){var o;i((o=r.target)==null?void 0:o.result)},t){case"ArrayBuffer":n.readAsArrayBuffer(e);break;case"DataURL":n.readAsDataURL(e);break;case"Text":n.readAsText(e,"utf-8");break;default:i(void 0)}})}static async blobToImage(e){const t=await this.readBlob(e,"ArrayBuffer");return t?await this.imageSrcToImage(this.arrayBufferToImageSrc(t)):null}static async arrayBufferToImage(e){return await this.imageSrcToImage(this.arrayBufferToImageSrc(e))}static arrayBufferToImageSrc(e){return URL.createObjectURL(new Blob([e]))}static async imageSrcToImage(e){return new Promise(t=>{const i=new Image;i.onload=function(){t(i)},i.src=e})}static async canvasToBlob(e,t="image/png",i=.92){return new Promise(n=>e.toBlob(n,t,i))}static clearCanvas(e){const t=e.width,i=e.height,n=e.getContext("2d");n&&(n.save(),n.clearRect(0,0,t,i),n.restore())}static fillImageToCanvas(e,t){const i=e.width,n=e.height,r=e.getContext("2d");if(r){r.save(),r.fillStyle="rgba(255, 255, 255, 1)",r.fillRect(0,0,i,n);const o=Math.min(e.width/t.width,e.height/t.height),s=Math.round(t.width*o),u=Math.round(t.height*o);r.drawImage(t,0,0,t.width,t.height,(i-s)/2,(n-u)/2,s,u),r.restore()}}static repeatImageToCanvas(e,t,i,n,r,o){const s=e.getContext("2d");if(s){s.save();for(let u=0;u<o;u+=t.height)for(let l=0;l<r;l+=t.width){const h=l+t.width>r?r-l:t.width,g=u+t.height>o?o-u:t.height;s.drawImage(t,0,0,h,g,i+l,n+u,h,g)}s.restore()}}static appendToCanvas(e,t){const i=e.width,n=e.height,r=e.height,o=t.height*(e.width/t.width),s=e.getContext("2d");if(s){s.save();const u=s.getImageData(0,0,i,n);e.height+=o,s.putImageData(u,0,0),s.drawImage(t,0,0,t.width,t.height,0,r,i,o),s.restore()}}static drawText(e,t,i,n,r,o){const s=e.getContext("2d");return s&&(s.save(),r&&(s.font=r),o&&(s.fillStyle=o),s.fillText(t,i,n),s.restore()),this.measureText(e,t,i,n,r,o)}static measureText(e,t,i,n,r,o){let s={x:0,y:0,width:0,height:0};const u=e.getContext("2d");if(u){u.save(),r&&(u.font=r),o&&(u.fillStyle=o);const l=u.measureText(t);s={x:i,y:n,width:l.width,height:l.fontBoundingBoxAscent+l.fontBoundingBoxDescent},u.restore()}return s}static drawTextAlign(e,t,i,n,r,o,s,u="left"){const l=e.getContext("2d");if(l){l.save(),o&&(l.font=o),s&&(l.fillStyle=s);const h=l.measureText(t);l.fillText(t,u==="left"?i:u==="center"?i+(r-h.width)/2:i+(r-h.width),n),l.restore()}return this.measureTextAlign(e,t,i,n,r,o,s,u)}static measureTextAlign(e,t,i,n,r,o,s,u="left"){const l=this.measureText(e,t,i,n,o,s);return{...l,x:u==="left"?i:u==="center"?i+(r-l.width)/2:i+(r-l.width)}}static drawTextFixWidth(e,t,i,n,r,o,s){const u=e.getContext("2d");if(u){u.save(),o&&(u.font=o),s&&(u.fillStyle=s);const l=[];let h=0;for(const f of t){const c=u.measureText(f).width;h+=c,l.push(c)}const g=(r-h)/(t.length-1);h=0;for(let f=0;f<t.length;f++)u.fillText(t.charAt(f),i+h,n),h+=g+l[f];u.restore()}return this.measureTextFixWidth(e,t,i,n,r,o,s)}static measureTextFixWidth(e,t,i,n,r,o,s){return{...this.measureText(e,t,i,n,o,s),width:r}}static drawTextMultiline(e,t,i,n,r,o,s,u=1){const l=e.getContext("2d");let h=0;if(l){if(l.save(),o&&(l.font=o),s&&(l.fillStyle=s),l.measureText(t).width<=r)l.fillText(t,i,n);else{let f="";for(let c=0;c<t.length;c++){const d=l.measureText(f+t[c]);d.width>r?(l.fillText(f,i,n+h),h+=(d.fontBoundingBoxAscent+d.fontBoundingBoxDescent)*u,f=t[c]):(f+=t[c],c===t.length-1&&(l.fillText(f,i,n+h),h+=d.fontBoundingBoxAscent+d.fontBoundingBoxDescent))}}l.restore()}return this.measureTextMultiline(e,t,i,n,r,o,s,u)}static measureTextMultiline(e,t,i,n,r,o,s,u=1){const l=e.getContext("2d");let h=0;if(l){l.save(),o&&(l.font=o),s&&(l.fillStyle=s);const g=l.measureText(t);if(g.width<=r)h+=g.fontBoundingBoxAscent+g.fontBoundingBoxDescent;else{let f="";for(let c=0;c<t.length;c++){const d=l.measureText(f+t[c]);d.width>r?(h+=(d.fontBoundingBoxAscent+d.fontBoundingBoxDescent)*u,f=t[c]):(f+=t[c],c===t.length-1&&(h+=d.fontBoundingBoxAscent+d.fontBoundingBoxDescent))}}l.restore()}return{x:i,y:n,width:r,height:h}}static downloadBlob(e,t){const i=URL.createObjectURL(t),n=document.createElement("a");n.href=URL.createObjectURL(t),n.download=e,n.style.display="none",document.body.appendChild(n),n.click(),setTimeout(()=>{document.body.removeChild(n),window.URL.revokeObjectURL(i)},0)}}export{ut as H,st as a,ot as b,nt as c,lt as d,it as e,ct as p,at as r,O as s,G as u,rt as v};
