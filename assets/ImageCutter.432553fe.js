import{d as pe,r as n,_ as ve,y as fe,k as s,z as c,p as a,m as t,f as l,Q as m,q as u,G as M,v as w,H as G,t as I,l as y,I as $,F as C,x as K,u as N,J as X,K as ge,L as he}from"./index.170ec828.js";import{Q as D,a as J}from"./use-transition.4d3a3d15.js";import{Q as E}from"./use-tick.6a87da87.js";import{R,M as Y,O as H,E as ee,I as V,a as j,Q as _e,b as O,c as W}from"./ImageCutterUtil.8002186f.js";import{Q as te}from"./QInput.51677d57.js";import{Q as Ie}from"./QPage.d74925b7.js";import{H as b}from"./HtmlUtil.53a61655.js";import"./_commonjsHelpers.d2428edb.js";import"./ObjectUtil.6ef4a9fd.js";var ye=pe({setup(){const e=n(R),r=n(Y),Z=n(H),Q=n(null),P=n(),v=n(),f=n(!1),o=n(),h=n(0),p=n(0),L=n(),q=n(0),z=n(1024),_=n(R[0].key),k=n(),T=n(Y[0].key),B=n(H[0].key),x=n(),F=n(-1);function le(){P.value=void 0,v.value=void 0,o.value=void 0,h.value=0,p.value=0,U()}function ae(){L.value=void 0}async function oe(i){const d=await b.readBlob(i,"ArrayBuffer");if(d){P.value=d;const g=b.arrayBufferToImageSrc(d);o.value=g;const S=await b.imageSrcToImage(g);v.value=S,h.value=S.width,p.value=S.height,U()}}async function se(i){const d=await b.readBlob(i,"ArrayBuffer");if(d){const g=await ee.arrayBufferToExcelJSWorkbook(d);L.value=V.importLongImageExcel(g),console.log(L.value)}}function ie(){try{if(k.value!==""&&k.value!==void 0&&k.value!==null){const i=Math.max(0,Math.min(parseFloat(k.value),.5));q.value=i,k.value=i.toString(),_.value="input"}else q.value=0,k.value=void 0,_.value=R[0].key}catch{q.value=0,k.value=void 0,_.value=R[0].key}U()}function ne(){try{if(x.value!==""&&x.value!==void 0&&x.value!==null){const i=Math.max(512,Math.min(parseInt(x.value),4096));z.value=i,x.value=i.toString(),B.value="input"}else z.value=0,x.value=void 0,B.value=H[0].key}catch{z.value=0,x.value=void 0,B.value=H[0].key}}function ue(){le()}function re(){ae()}function U(){if(b.clearCanvas(Q.value),F.value=-1,v.value){b.fillImageToCanvas(Q.value,v.value);const i={...j,input:q.value}[_.value],d=T.value;F.value=V.calcBaseImageCutSize(v.value,{ratio:i,mode:d}),V.fillSplitLineToCanvas(Q.value,{ratio:i,mode:d})}}async function de(){if(v.value){f.value=!0;const i={...j,input:q.value}[_.value],d=T.value,g={original:F.value,scale:Math.floor(Math.max(h.value,p.value)/3),input:z.value}[B.value],S=await V.outputBaseImageDataZip(v.value,{ratio:i,mode:d,targetSize:g});b.downloadBlob(`export-${_.value}-${g}px.zip`,S),f.value=!1}}async function ce(){if(v.value&&L.value){f.value=!0;const i={...j,input:q.value}[_.value],d=T.value,g={original:F.value,scale:Math.floor(Math.max(h.value,p.value)/3),input:z.value}[B.value],S=await V.outputLongImageDataZip(v.value,{ratio:i,mode:d,targetSize:g},L.value);b.downloadBlob(`export-long-${_.value}-${g}px.zip`,S),f.value=!1}}async function me(){f.value=!0;const i=V.exportLongImageExcel(V.getExampleLongImageExcel()),d=await ee.excelJSWorkbookToBlob(i);b.downloadBlob("example.xlsx",d),f.value=!1}return{ratioList:e,modeList:r,outputList:Z,previewCanvas:Q,outputLoading:f,originImageSrc:o,originImageWidth:h,originImageHeight:p,longImageExcel:L,ratioSelect:_,ratioInputValue:k,modeSelect:T,outputSelect:B,outputInputValue:x,baseImageCutSize:F,onOriginImageDrop:oe,onExcelConfigDrop:se,onRatioInputFocusOut:ie,onOutputInputFocusOut:ne,removeOriginImage:ue,removeLongImageExcel:re,repaintPreviewCanvas:U,outputBaseImage:de,outputLongImage:ce,exportDefaultExcel:me}}});const A=e=>(ge("data-v-65fb8dc0"),e=e(),he(),e),be={class:"fit column no-wrap"},ke={class:"m--flex--0-0"},xe={class:"fit row q-px-sm"},Se={class:"q-gutter-x-sm"},we={class:"m--flex--0-0"},Ce={class:"fit row q-pb-md q-px-sm"},Ve={class:"m--flex--1-1 flex flex-center"},Le={class:"full-height q-mx-sm"},qe={style:{width:"300px",height:"300px"}},Be={key:1,class:"fit relative-position"},Ee=A(()=>t("div",{class:"m--outline--dash--md m--border--radius--md fit absolute-top"},null,-1)),Oe={class:"absolute-bottom full-width flex flex-center q-pa-md"},Qe={class:"m--flex--1-1 flex flex-center"},ze={class:"full-height q-mx-sm"},Fe={style:{width:"300px",height:"300px"}},Me={class:"fit relative-position"},Te={class:"m--border--radius--md fit",ref:"previewCanvas",width:"3072",height:"3072"},Ue=A(()=>t("div",{class:"m--outline--dash--md m--border--radius--md fit absolute-top"},null,-1)),$e={class:"m--flex--1-1 flex flex-center"},De={class:"full-height q-mx-sm"},Re={class:"q-gutter-y-sm",style:{width:"300px"}},He={class:"m--border--solid--sm m--border--radius--q-btn row",style:{height:"36px"}},We={class:"m--flex--1-1 flex flex-center"},Ae={class:"q-gutter-y-sm",style:{width:"300px"}},Pe={class:"m--border--solid--sm m--border--radius--q-btn row",style:{height:"36px"}},Ne={class:"m--flex--1-1 flex flex-center"},Je={class:"q-gutter-y-sm",style:{width:"300px"}},je={class:"m--border--solid--sm m--border--radius--q-btn row",style:{height:"36px"}},Ze={class:"m--flex--1-1 flex flex-center"},Ge={class:"m--flex--1-1 flex flex-center"},Ke={class:"m--flex--1-1 flex flex-center"},Xe={class:"full-height q-mx-sm"},Ye={style:{width:"300px",height:"300px"}},et={key:1,class:"fit relative-position"},tt={class:"row q-px-md"},lt={class:"q-px-md"},at=A(()=>t("div",{class:"m--outline--dash--md m--border--radius--md fit absolute-top"},null,-1)),ot={class:"absolute-bottom full-width flex flex-center q-pa-md"},st={class:"m--flex--0-0"},it={class:"q-gutter-x-sm"},nt=A(()=>t("div",{class:"m--flex--1-1"},null,-1));function ut(e,r,Z,Q,P,v){const f=fe("m-file-drop-area");return s(),c(Ie,{style:{height:"0"}},{default:a(()=>[t("div",be,[t("div",ke,[t("div",xe,[l(G,{class:"fit q-pa-none no-wrap text-no-wrap"},{default:a(()=>[l(D,null,{default:a(()=>[l(m,{header:""},{default:a(()=>[u("\u57FA\u672C\u8BBE\u7F6E")]),_:1})]),_:1}),l(D,{side:"",class:"q-mr-md"},{default:a(()=>[t("div",Se,[l(M,{unelevated:"","no-caps":"",color:"primary",label:"\u5BFC\u51FA\u4E5D\u5BAB\u683C",onClick:w(e.outputBaseImage,["prevent","stop"]),loading:e.outputLoading,disable:!e.originImageSrc},{loading:a(()=>[l(J)]),_:1},8,["onClick","loading","disable"])])]),_:1})]),_:1})])]),l(E),t("div",we,[t("div",Ce,[t("div",Ve,[t("div",Le,[e.originImageSrc?(s(),c(m,{key:1,header:""},{default:a(()=>[u("\u539F\u59CB\u56FE\u7247\uFF1A"+I(e.originImageWidth)+" px * "+I(e.originImageHeight)+" px",1)]),_:1})):(s(),c(m,{key:0,header:""},{default:a(()=>[u("\u539F\u59CB\u56FE\u7247")]),_:1})),t("div",qe,[e.originImageSrc?(s(),y("div",Be,[l(_e,{class:"fit m--border--radius--md",fit:"contain",src:e.originImageSrc},null,8,["src"]),Ee,t("div",Oe,[l(M,{unelevated:"",color:"negative",label:"\u5220\u9664\u539F\u56FE",onClick:w(e.removeOriginImage,["prevent","stop"])},null,8,["onClick"])])])):(s(),c(f,{key:0,class:"fit",filter:["png","jpg","jpeg"],onUpload:e.onOriginImageDrop},null,8,["onUpload"]))])])]),t("div",Qe,[t("div",ze,[e.baseImageCutSize<0?(s(),c(m,{key:0,header:""},{default:a(()=>[u("\u6548\u679C\u9884\u89C8")]),_:1})):(s(),c(m,{key:1,header:""},{default:a(()=>[u("\u6548\u679C\u9884\u89C8\uFF1A"+I(e.baseImageCutSize)+" px / "+I(Math.floor(Math.max(e.originImageWidth,e.originImageHeight)/3))+" px",1)]),_:1})),t("div",Fe,[t("div",Me,[t("canvas",Te,null,512),Ue])])])]),t("div",$e,[t("div",De,[l(m,{header:""},{default:a(()=>[u("\u5200\u7EBF\u6BD4\u7387")]),_:1}),t("div",Re,[t("div",He,[(s(!0),y(C,null,$(e.ratioList,(o,h)=>(s(),y(C,{key:o.key},[o.key!=="input"?(s(),y(C,{key:0},[t("div",We,[l(W,{dense:"",label:o.name,modelValue:e.ratioSelect,"onUpdate:modelValue":r[0]||(r[0]=p=>e.ratioSelect=p),val:o.key,onClick:w(e.repaintPreviewCanvas,["prevent","stop"])},{default:a(()=>[l(O,{anchor:"center left",self:"center right"},{default:a(()=>[u(I(o.value),1)]),_:2},1024)]),_:2},1032,["label","modelValue","val","onClick"])]),h<e.ratioList.map(p=>p.key).indexOf("input")-1?(s(),c(E,{key:0,vertical:""})):N("",!0)],64)):N("",!0)],64))),128))]),l(te,{dense:"",outlined:"",clearable:"",type:"number",min:"0",max:"0.5",step:"0.01",placeholder:"\u8BF7\u8F93\u5165\u6BD4\u7387\uFF080 ~ 0.5\uFF09",class:K("m--btn-input"+(e.ratioSelect==="input"?" --selected":"")+" full-width"),"input-class":"m--btn-input--input",modelValue:e.ratioInputValue,"onUpdate:modelValue":r[1]||(r[1]=o=>e.ratioInputValue=o),onFocus:r[2]||(r[2]=o=>e.ratioSelect="input"),onFocusout:e.onRatioInputFocusOut},null,8,["class","modelValue","onFocusout"])]),l(m,{header:""},{default:a(()=>[u("\u5207\u5272\u65B9\u5F0F")]),_:1}),t("div",Ae,[t("div",Pe,[(s(!0),y(C,null,$(e.modeList,(o,h)=>(s(),y(C,{key:o.key},[t("div",Ne,[l(W,{dense:"",label:o.name,modelValue:e.modeSelect,"onUpdate:modelValue":r[3]||(r[3]=p=>e.modeSelect=p),val:o.key,onClick:w(e.repaintPreviewCanvas,["prevent","stop"])},{default:a(()=>[l(O,{anchor:"center left",self:"center right"},{default:a(()=>[u(I(o.description),1)]),_:2},1024)]),_:2},1032,["label","modelValue","val","onClick"])]),h<e.modeList.length-1?(s(),c(E,{key:0,vertical:""})):N("",!0)],64))),128))])]),l(m,{header:""},{default:a(()=>[u("\u5BFC\u51FA\u5C3A\u5BF8")]),_:1}),t("div",Je,[t("div",je,[t("div",Ze,[l(W,{dense:"",label:"\u539F\u59CB\u50CF\u7D20",modelValue:e.outputSelect,"onUpdate:modelValue":r[4]||(r[4]=o=>e.outputSelect=o),val:"original"},{default:a(()=>[e.baseImageCutSize<0?(s(),c(O,{key:0,anchor:"center left",self:"center right"},{default:a(()=>[u("\u6309\u7167\u5207\u5272\u540E\u7684\u50CF\u7D20\u76F4\u63A5\u5BFC\u51FA")]),_:1})):(s(),c(O,{key:1,anchor:"center left",self:"center right"},{default:a(()=>[u("\u6309\u7167\u5207\u5272\u540E\u7684\u50CF\u7D20\u76F4\u63A5\u5BFC\u51FA\uFF08"+I(e.baseImageCutSize)+" px\uFF09",1)]),_:1}))]),_:1},8,["modelValue"])]),l(E,{vertical:""}),t("div",Ge,[l(W,{dense:"",label:"\u586B\u5145\u5207\u7EBF",modelValue:e.outputSelect,"onUpdate:modelValue":r[5]||(r[5]=o=>e.outputSelect=o),val:"scale"},{default:a(()=>[e.baseImageCutSize<0?(s(),c(O,{key:0,anchor:"center left",self:"center right"},{default:a(()=>[u("\u5207\u5272\u540E\uFF0C\u653E\u5927\u5230\u539F\u56FE\u7684 1/3 \u50CF\u7D20\u5BFC\u51FA")]),_:1})):(s(),c(O,{key:1,anchor:"center left",self:"center right"},{default:a(()=>[u("\u5207\u5272\u540E\uFF0C\u653E\u5927\u5230\u539F\u56FE\u7684 1/3 \u50CF\u7D20\u5BFC\u51FA\uFF08"+I(Math.floor(Math.max(e.originImageWidth,e.originImageHeight)/3))+" px\uFF09",1)]),_:1}))]),_:1},8,["modelValue"])])]),l(te,{dense:"",outlined:"",clearable:"",type:"number",min:"512",max:"4096",step:"512",placeholder:"\u8BF7\u8F93\u5165\u76EE\u6807\u50CF\u7D20\uFF08512 ~ 4096\uFF09",class:K("m--btn-input"+(e.outputSelect==="input"?" --selected":"")+" full-width"),"input-class":"m--btn-input--input",modelValue:e.outputInputValue,"onUpdate:modelValue":r[6]||(r[6]=o=>e.outputInputValue=o),onFocus:r[7]||(r[7]=o=>e.outputSelect="input"),onFocusout:e.onOutputInputFocusOut},null,8,["class","modelValue","onFocusout"])])])]),t("div",Ke,[t("div",Xe,[l(m,{header:""},{default:a(()=>[u("Excel \u914D\u7F6E\u6587\u4EF6\uFF08\u53EF\u9009\uFF09")]),_:1}),t("div",Ye,[e.longImageExcel?(s(),y("div",et,[l(m,{header:""},{default:a(()=>[u("\u4E3B\u9898\u914D\u8272")]),_:1}),t("div",tt,[(s(),y(C,null,$(9,o=>t("div",{key:o,class:"m--border--solid--sm",style:{padding:"2px"}},[t("div",{class:"m--border--solid--sm",style:X("padding: 11.56px;background-color: "+e.longImageExcel.config[`themeColor${o}`])},null,4)])),64))]),l(m,{header:""},{default:a(()=>[u("\u4E3B\u9898\u5B57\u4F53")]),_:1}),t("div",lt,[(s(),y(C,null,$(4,o=>t("div",{key:o,class:"m--border--solid--sm q-pa-xs"},[l(m,{style:X("font-family: "+e.longImageExcel.config[`themeFont${o}`])},{default:a(()=>[u(I(e.longImageExcel.config[`themeFont${o}`]),1)]),_:2},1032,["style"])])),64))]),at,t("div",ot,[l(M,{unelevated:"",color:"negative",label:"\u6E05\u7A7A\u914D\u7F6E",onClick:w(e.removeLongImageExcel,["prevent","stop"])},null,8,["onClick"])])])):(s(),c(f,{key:0,class:"fit",filter:["xls","xlsx"],onUpload:e.onExcelConfigDrop},null,8,["onUpload"]))])])])])]),l(E),t("div",st,[l(G,{class:"fit q-pa-none no-wrap text-no-wrap"},{default:a(()=>[l(D,null,{default:a(()=>[l(m,{header:""},{default:a(()=>[u("\u957F\u56FE\u8BBE\u7F6E")]),_:1})]),_:1}),l(D,{side:"",class:"q-mr-md"},{default:a(()=>[t("div",it,[l(M,{outline:"","no-caps":"",color:"primary",label:"\u83B7\u53D6\u793A\u4F8B",onClick:w(e.exportDefaultExcel,["prevent","stop"]),loading:e.outputLoading},{loading:a(()=>[l(J)]),_:1},8,["onClick","loading"]),l(M,{unelevated:"","no-caps":"",color:"primary",label:"\u5BFC\u51FA\u957F\u56FE",onClick:w(e.outputLongImage,["prevent","stop"]),loading:e.outputLoading,disable:!e.originImageSrc||!e.longImageExcel},{loading:a(()=>[l(J)]),_:1},8,["onClick","loading","disable"])])]),_:1})]),_:1})]),l(E),nt])]),_:1})}var _t=ve(ye,[["render",ut],["__scopeId","data-v-65fb8dc0"]]);export{_t as default};
